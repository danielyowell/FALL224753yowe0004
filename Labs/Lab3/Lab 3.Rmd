---
title: "Lab 3: MATH 4753"
author: "Your name"
date: "January 28, 2019"
output: 
  html_document:
    toc: yes
    toc_float: yes
    theme: spacelab
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Task 1

WD

```{r}
getwd()
```

# Task 2
### Read SPRUCE.csv into data frame spruce.df and print head

```{r}
spruce.df = read.csv("SPRUCE.csv")
head(spruce.df)
```



# Task 3
### Make a scatter plot of spruce.df.
```{r}

plot(Height~BHDiameter, 
     main="Daniel Yowell - Task 3 Scatter Plot", 
     data = spruce.df, 
     pch=21, 
     bg="Blue", 
     cex=1.2, 
     xlim = c(0,1.1*max(BHDiameter)), 
     ylim = c(0,1.1*max(Height))
     )
```
### Does there appear to be a straight line relationship?

Not really; the line curves towards the horizontal near the middle of the plot.

### Load the library s20x and make a lowess smoothed scatter plot using trendscatter(). Try a few values of f: f=0.5,0.6,0.7), and record all three plots using layout().

```{r}
library(s20x)
lo = layout(matrix(1:4, nr = 2, nc = 2, byrow = TRUE))

a <- trendscatter(Height~BHDiameter, data = spruce.df, main="Lowess Plot: f = 0.5", f=0.5) 
b <- trendscatter(Height~BHDiameter, data = spruce.df, main="Lowess Plot: f = 0.6", f=0.6) 
c <- trendscatter(Height~BHDiameter, data = spruce.df, main="Lowess Plot: f = 0.7", f=0.7) 

``` 
### We will assume (this may in fact be a bad assumption) a straight line relationship. 
### Using lm, create a linear model object called spruce.lm 
### Make a new scatter plot and add the least squares regression line to the points - abline(spruce.lm) – and record the plot.


```{r}
# Create spruce.lm (linear model object)
spruce.lm = lm(Height~BHDiameter, data = spruce.df)
# To see basic data about spruce.lm, use command: summary(spruce.lm)

# New scatter plot with least squares regression line
plot(Height~BHDiameter, 
     main="Daniel Yowell - Scatter Plot with Regression Line", 
     data = spruce.df, 
     pch=21, 
     bg="Blue", 
     cex=1.2, 
     xlim = c(0,1.1*max(BHDiameter)), 
     ylim = c(0,1.1*max(Height))
     )
abline(spruce.lm)
```

### Is a straight line appropriate? Consider the smoother curve also.

The straight line is not the most accurate representation of the trend in this plot. There is still lots of deviation when observing certain points, particularly those at the lower and higher X values. The lowess smoothed curves do a much better job at staying close to the data.

# Task 4

### Divide the graphical interface into 4 equal areas, use layout.show(4) and record the picture.
### - In the first square, plot the scatter plot and fitted line.
### - In the second square plot the same with the residual line segments (deviations about the fitted line). (RSS=residual sum of squares)
### - In the third square plot the mean of Y versus X i.e. mean of Height vs BHDiameter, with the fitted line and deviations of the fitted line from the mean height added. (MSS=model sum of squares)
### - In the fourth square plot the mean of Height versus BHDiameter and show the total deviation line segments \hat{y}=\bar{y}. (TSS=total sum of squares) 

```{r}
# Format output: 4 squares
layout(matrix(1:4, nr = 2, nc = 2, byrow = TRUE))

# SQUARE 1: original scatter plot + linear regression line
a <- plot(Height~BHDiameter, 
          main="Daniel Yowell - Original Plot", 
          data = spruce.df, 
          pch=21, 
          bg="Blue", 
          cex=1.2, 
          xlim = c(0,1.1*max(BHDiameter)), 
          ylim = c(0,1.1*max(Height))
          )
abline(spruce.lm)

# SQUARE 2: RSS

with(spruce.df,
     plot(Height~BHDiameter,
          bg="Blue",
          pch=21,
          cex=1.2, 
          ylim=c(0,1.1*max(Height)),
          xlim=c(0,1.1*max(BHDiameter)),
          main="Daniel Yowell - RSS Plot"
          )
)

# yhat = the estimates of E[Height | BHDiameter]
yhat=with(spruce.df,predict(spruce.lm,data.frame(BHDiameter)))

# Draw in segments displaying residuals (regression deviations)
with(spruce.df,{
  segments(BHDiameter,Height,BHDiameter,yhat)
})
abline(spruce.lm)

# SQUARE 3: MSS

with(spruce.df,
     plot(Height~BHDiameter,
          bg="Blue",
          pch=21,
          ylim=c(0,1.1*max(Height)),
          xlim=c(0,1.1*max(BHDiameter)),
          main="Daniel Yowell - MSS Plot"
          )
)

#make naïve model (horizonal line at mean height) and display on plot
with(spruce.df, abline(h=mean(Height)))
abline(spruce.lm)

#make the explained deviations (explained by the model)
with(spruce.df, segments(BHDiameter,mean(Height),BHDiameter,yhat,col="Red"))

# SQUARE 4: TSS
with(spruce.df,
     plot(Height~BHDiameter,
          bg="Blue",
          pch=21,
          ylim=c(0,1.1*max(Height)),
          xlim=c(0,1.1*max(BHDiameter)),
          main="Daniel Yowell - TSS Plot"
          )
)

# plot mean height again
with(spruce.df,abline(h=mean(Height)))

# draw green segments from linear regression line to mean height
with(spruce.df, segments(BHDiameter,Height,BHDiameter,mean(Height),col="Green"))

# layout.show() is not necessary, as plots display automatically
``` 

### Calculate TSS, MSS and RSS

```{r}
# RSS (residual sum of squares)
RSS=with(spruce.df,sum((Height-yhat)^2))
cat("RSS = ", RSS, "\n")
# RSS = 95.70281

# MSS (model sum of squares)
MSS=with(spruce.df,sum((yhat-mean(Height))^2))
cat("MSS = ", MSS, "\n")
# MSS = 183.2447

# TSS (total sum of squares)
TSS=with(spruce.df,sum((Height-mean(Height))^2))
cat("TSS = ", TSS, "\n")
# TSS = 278.9475
```

### Calculate \frac{MSS}{TSS}, and interpret it!
```{r}
cat("MSS/TSS = ", MSS/TSS, "\n")
# Also available in summary info under "Multiple R-squared:  0.6569"
```
Multiple R-squared measures how well our predicted model aligns with the actual data. 
Effectively, it is a measure of correlation.

### Does TSS=MSS+RSS?

```{r}
cat("TSS = ", TSS, "\n")
cat("RSS + MSS = ", RSS + MSS, "\n")
```

Yes!

# Task 5

### Summarize spruce.lm paste it here.

```{r}
summary(spruce.lm)
```

### What is the value of the slope?

0.48147 (listed as a "coefficient")

### What is the value of the intercept?

9.14684

### Write down the equation of the fitted line.

y = 9.14684x + 0.48147

### Predict the Height of spruce when the Diameter is 15, 18 and 20cm (use predict())

```{r}

new_frame <- data.frame(spruce.df, BHDiameter = c(15, 18, 20))

predict(spruce.lm, predictions = new_frame)

```
When BHDiameter = 15cm: Height = 18.77632cm \\
When BHDiameter = 18cm: Height = 11.93939cm \\
When BHDiameter = 20cm: Height = 19.11336cm

# Task 6

### Use appropriate code using the ggplot2 package to make a plot of Height Vs Diameter with shading lines and a legend.

```{r}
ggplot(spruce.df, aes(x = BHDiameter, y = Height, color = Height)) +
  geom_line() +
  geom_smooth(method = "lm", se = TRUE) +
  geom_point(size=1, alpha = 1) + 
  labs(
    title = "Daniel Yowell - Height vs. Diameter",
    x = "Diameter (cm)",
    y = "Height (cm)"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5)  # Center the plot title
  )
```

#Task 7
This is how you place images in RMD documents

<center>
!["name of image"](gHeight.png){ width=70% }
</center>


